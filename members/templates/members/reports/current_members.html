{% extends 'members/base.html' %}

{% block title %}Current Members Report - ALANO CLUB{% endblock %}

{% block extra_css %}
<style>
@media print {
    /* Hide navigation elements */
    .navbar { display: none !important; }
    .sidebar { display: none !important; }
    .offcanvas { display: none !important; }
    
    /* Hide buttons */
    .btn { display: none !important; }
    
    /* Make content full width */
    .container-fluid { padding: 0 !important; }
    main { 
        width: 100% !important; 
        margin-left: 0 !important;
        padding: 0 !important;
    }
    
    /* Remove card styling for cleaner print */
    .card { border: none !important; box-shadow: none !important; }
    .card-header { border-bottom: 2px solid #000 !important; }
    
    /* Ensure tables print properly */
    .table-responsive { overflow: visible !important; }
    
    /* Fix summary cards to print full width */
    .row.justify-content-center {
        justify-content: flex-start !important;
    }
    
    .row .col-md-4 {
        width: 33.333% !important;
        flex: 0 0 33.333% !important;
        max-width: 33.333% !important;
    }
}

/* Set Name column to 25% width */
.table th:nth-child(1),
.table td:nth-child(1) {
    width: 25% !important;
    max-width: 25% !important;
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="row justify-content-center">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <h1 class="mb-0">
                        <i class="bi bi-file-text me-2"></i>
                        Current Members Report
                    </h1>
                    <div>
                        <button type="button" class="btn btn-light me-2" onclick="window.print()">
                            <i class="bi bi-printer me-1"></i>
                            Print Report
                        </button>
                        <span class="badge bg-light text-dark">{{ report_date|date:"F j, Y" }}</span>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Summary -->
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <div class="card bg-light">
                                <div class="card-body text-center">
                                    <h3 class="text-primary">{{ total_regular }}</h3>
                                    <p class="mb-0">Regular Members</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card bg-light">
                                <div class="card-body text-center">
                                    <h3 class="text-success">{{ total_life }}</h3>
                                    <p class="mb-0">Life Members</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card bg-primary text-white">
                                <div class="card-body text-center">
                                    <h3>{{ total_members }}</h3>
                                    <p class="mb-0">Total Active Members</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Regular Members Section -->
                    {% if regular_members %}
                    <h3 class="mb-3">Regular Members</h3>
                    <div class="table-responsive mb-5">
                        <table class="table table-striped table-sm">
                            <thead class="table-dark">
                                <tr>
                                    <th>Name</th>
                                    <th>ID</th>
                                    <th>Type</th>
                                    <th>Date Joined</th>
                                    <th>Expires</th>
                                    <th>Recent Payments</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for member_data in regular_members %}
                                <tr>
                                    <td><strong>{{ member_data.member.last_name }}, {{ member_data.member.first_name }}</strong></td>
                                    <td>{{ member_data.member.member_id|default:"—" }}</td>
                                    <td>{{ member_data.member.member_type.member_type|default:"—" }}</td>
                                    <td>{{ member_data.member.date_joined|date:"n/j/Y" }}</td>
                                    <td>{{ member_data.member.expiration_date|date:"n/j/Y" }}</td>
                                    <td>
                                        {% if member_data.payments %}
                                            <small>
                                                {% for payment in member_data.payments %}
                                                    <div><strong>Receipt:</strong> {{ payment.receipt_number|default:"—" }}</div>
                                                    <div>{{ payment.date|date:"n/j/Y" }} - ${{ payment.amount }}</div>
                                                    {% if not forloop.last %}<hr style="margin: 4px 0;">{% endif %}
                                                {% endfor %}
                                            </small>
                                        {% else %}
                                            <em class="text-muted">No payments</em>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% endif %}

                    <!-- Life Members Section -->
                    {% if life_members %}
                    <h3 class="mb-3">Life Members</h3>
                    <div class="table-responsive">
                        <table class="table table-striped table-sm">
                            <thead class="table-success">
                                <tr>
                                    <th>Name</th>
                                    <th>ID</th>
                                    <th>Type</th>
                                    <th>Date Joined</th>
                                    <th>Expires</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for member_data in life_members %}
                                <tr>
                                    <td><strong>{{ member_data.member.last_name }}, {{ member_data.member.first_name }}</strong></td>
                                    <td>{{ member_data.member.member_id|default:"—" }}</td>
                                    <td>{{ member_data.member.member_type.member_type|default:"—" }}</td>
                                    <td>{{ member_data.member.date_joined|date:"n/j/Y" }}</td>
                                    <td>{{ member_data.member.expiration_date|date:"n/j/Y" }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
